<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        canvas {
            background-color: #f1f1f1;
            height: 98vh;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
        }

        * {
            margin: 0px;
            padding: 0px;
        }
    </style>
</head>
<body onload="startGame()">
    <script>
        var maxClicks, recipes, dropitem, defaultTile, placable, speed = 0.0625, count = 31, dropblocs = [], invIndex = -1, walkable, blocks = [], screenNum = 0, biomes = [], inventory = [['e1', ''], ['e2', ''], ['e3', ''], ['e4', ''], ['e5', ''], ['e6', ''], ['e7', ''], ['e8', ''], ['e9', ''], ['e10', ''], ['e11', ''], ['e12', ''], ['e13', ''], ['e14', ''], ['e15', ''], ['e16', ''], ['e17', ''], ['e18', ''], ['e19', ''], ['e20', ''], ['e21', ''], ['e22', ''], ['e23', ''], ['e24', ''], ['e25', ''], ['e26', ''], ['e27', ''], ['e28', ''], ['e29', ''], ['e30', '']], selectIndex = 0, xpos = 500, ypos = 500, height = 1000, width = 1000, blockimg, lastClick = { x: -1, y: -1 }, clickCount = 1, bImage = new Image(), cs = document.createElement("CANVAS"), map = [], mapview = [];
        bImage.src = 'imgs/index wp.png';
        function startGame() {
            for (var i = 0; i < height; i++) {
                blocks[i] = [];
            }
            recipes = data.recipes;
            maxClicks = data.maxClicks;
            defaultTile = data.defaultTile;
            walkable = data.walkable;
            dropitem = data.dropitem;
            placable = data.placable;
            blockimg = data.blockimg;
            myGameArea.start();
            myGameArea.context.imageSmoothingEnabled = false;
        }
        var myGameArea = {
            keys: [],
            getc: function () {
                return blocks[Math.floor(ypos + this.y / 100 - 3)][Math.floor(xpos + this.x / 100 - 3)];
            },
            setc: function (e) {
                blocks[Math.floor(ypos + myGameArea.y / 100 - 3)][Math.floor(xpos + myGameArea.x / 100 - 3)] = e;
            },
            add: function (c, n) {
                var p = 0;
                for (var x = 0; x < inventory.length; x++) {
                    if (inventory[x][0] == c) {
                        inventory[x][1] += n;
                        p = 1;
                        break;
                    }
                }
                if (p == 0) {
                    for (var w = 0; w < inventory.length; w++) {
                        if (inventory[w][1] === '') {
                            inventory[w][1] = n;
                            inventory[w][0] = c;
                            break;
                        }
                    }
                }
            },
            start: function () {
                document.getElementById("canvas").width = 700;
                document.getElementById("canvas").height = 700;
                this.context = document.getElementById("canvas").getContext("2d");
                imgp.src = 'imgs/player.png';
                imgp.onload = function () {
                    setInterval(updateGameArea, 20);
                };
                window.addEventListener('keydown', function (e) {
                    myGameArea.keys = (myGameArea.keys || []);
                    myGameArea.keys[e.keyCode] = (e.type == "keydown");
                });
                window.addEventListener('keyup', function (e) {
                    myGameArea.keys[e.keyCode] = (e.type == "keydown");
                });
                window.addEventListener('mousedown', function (e) {
                    myGameArea.x = e.clientX * 70000 / (98 * window.innerHeight);
                    myGameArea.y = e.clientY * 70000 / (98 * window.innerHeight);
                    myGameArea.ax = e.clientX * 70000 / (98 * window.innerHeight);
                    myGameArea.ay = e.clientY * 70000 / (98 * window.innerHeight);
                    myGameArea.click = true;
                });
                window.addEventListener('mousemove', function (e) {
                    myGameArea.x = e.clientX * 70000 / (98 * window.innerHeight);
                    myGameArea.y = e.clientY * 70000 / (98 * window.innerHeight);
                    myGameArea.ax = e.clientX * 70000 / (98 * window.innerHeight);
                    myGameArea.ay = e.clientY * 70000 / (98 * window.innerHeight);
                });
                window.addEventListener('mouseup', function (e) {
                    myGameArea.x = false;
                    myGameArea.y = false;
                    myGameArea.click = false;
                });
                window.addEventListener('touchstart', function (e) {
                    myGameArea.x = e.clientX * 70000 / (98 * window.innerHeight);
                    myGameArea.y = e.clientY * 70000 / (98 * window.innerHeight);
                });
                window.addEventListener('touchmove', function (e) {
                    myGameArea.x = e.touches[0].clientX * 70000 / (98 * window.innerHeight);
                    myGameArea.y = e.touches[0].clientY * 70000 / (98 * window.innerHeight);
                });
                window.addEventListener('touchend', function (e) {
                    myGameArea.x = false;
                    myGameArea.y = false;
                });
            },
            clear: function () {
                this.context.clearRect(0, 0, document.getElementById("canvas").width, document.getElementById("canvas").height);
            }
        };
        function updateGameArea() {
            myGameArea.clear();
            if (screenNum == 0) {
                myGameArea.context.drawImage(bImage, 0, 0, 700, 700);
                if (myGameArea.x && myGameArea.y && myGameArea.x > 286 && myGameArea.y > 286 && myGameArea.x < 413 && myGameArea.y < 413 && myGameArea.click) {
                    loadTiles();
                    loadMap();
                    screenNum = 1;
                }
            } else if (screenNum == 1) {
                clearBlanks();
                renderBlocks();
                interact();
                renderDrops();
                renderPlayer(move());
                renMobs();
                renderHotbar();
                slotSwitch();
                updateMap();
                openMap();
                if (myGameArea.keys && (myGameArea.keys[69] || myGameArea.keys[101])) {
                    screenNum = 2;
                    myGameArea.keys[101] = false;
                    myGameArea.keys[69] = false;
                }
            } else if (screenNum == 2) {
                myGameArea.context.fillStyle = '#000066';
                myGameArea.context.fillRect(0, 0, 700, 700);
                closeInventory();
                renderItems();
                clearBlanks();
                dealWithSwaps();
                dealWithCrafts(renderRecipes());
            } else if (screenNum == 3) {
                renderMap();
                closeMap();
            }
        }
    </script>
    <script src="src/data.js"></script>
    <script src="src/motion.js"></script>
    <script src="src/generate.js"></script>
    <script src="src/render.js"></script>
    <script src="src/inventory.js"></script>
    <canvas id="canvas"></canvas>
</body>
</html>